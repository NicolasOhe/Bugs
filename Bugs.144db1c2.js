!function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var e=function(){function e(t,r){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.total=0,this.elements=[],this.register={},null==t)throw new Error("The stats class needs a range!");this.range=t,this.last=0,this.count=0,this.domElement=this.linkToDOM(r)}var r,n,i;return r=e,(n=[{key:"linkToDOM",value:function(t){var e=document.querySelector(t);return e||(console.warn("Stats: no selector was provided. A <p> element was added to the end of <body>"),e=document.createElement("p"),document.querySelector("body").appendChild(e)),e}},{key:"tick",value:function(t){if("number"!=typeof t)return 0;this.count++;var e=t-this.last;return this.elements.push(e),this.total+=e,this.last=t,this.count>this.range&&(this.total-=this.elements.shift()),this.count%this.range==0&&this.updateDom(),e}},{key:"add",value:function(t,e){if("number"==typeof e){this.register[t]||(this.register[t]={elements:[],last:0,count:0,total:0});var r=this.register[t];r.elements.push(e),r.total+=e,r.count++,r.count>this.range&&(r.total-=r.elements.shift(),r.count--)}}},{key:"updateDom",value:function(){for(var t=Math.round(1e3/(this.total/this.range)),e="".concat(t," fps"),r=0,n=Object.keys(this.register);r<n.length;r++){var i=n[r],o=this.register[i],a=Math.round(o.total/o.count);e+="; ".concat(i,": ").concat(a)}this.domElement.innerHTML=e}}])&&t(r.prototype,n),i&&t(r,i),e}();function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n=function(t){var e,n,i;if(t&&"object"===r(t)&&t.hasOwnProperty("elements")){for(n=t.elements,i=new Float32Array(16),e=0;e<16;++e)i[e]=n[e];this.elements=i}else this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};n.prototype.setIdentity=function(){var t=this.elements;return t[0]=1,t[4]=0,t[8]=0,t[12]=0,t[1]=0,t[5]=1,t[9]=0,t[13]=0,t[2]=0,t[6]=0,t[10]=1,t[14]=0,t[3]=0,t[7]=0,t[11]=0,t[15]=1,this},n.prototype.set=function(t){var e,r,n;if((r=t.elements)!==(n=this.elements)){for(e=0;e<16;++e)n[e]=r[e];return this}},n.prototype.concat=function(t){var e,r,n,i,o,a,s,u;if(r=this.elements,n=this.elements,r===(i=t.elements))for(i=new Float32Array(16),e=0;e<16;++e)i[e]=r[e];for(e=0;e<4;e++)o=n[e],a=n[e+4],s=n[e+8],u=n[e+12],r[e]=o*i[0]+a*i[1]+s*i[2]+u*i[3],r[e+4]=o*i[4]+a*i[5]+s*i[6]+u*i[7],r[e+8]=o*i[8]+a*i[9]+s*i[10]+u*i[11],r[e+12]=o*i[12]+a*i[13]+s*i[14]+u*i[15];return this},n.prototype.multiply=n.prototype.concat,n.prototype.multiplyVector3=function(t){var e=this.elements,r=t.elements,n=new i,o=n.elements;return o[0]=r[0]*e[0]+r[1]*e[4]+r[2]*e[8]+e[11],o[1]=r[0]*e[1]+r[1]*e[5]+r[2]*e[9]+e[12],o[2]=r[0]*e[2]+r[1]*e[6]+r[2]*e[10]+e[13],n},n.prototype.multiplyVector4=function(t){var e=this.elements,r=t.elements,n=new o,i=n.elements;return i[0]=r[0]*e[0]+r[1]*e[4]+r[2]*e[8]+r[3]*e[12],i[1]=r[0]*e[1]+r[1]*e[5]+r[2]*e[9]+r[3]*e[13],i[2]=r[0]*e[2]+r[1]*e[6]+r[2]*e[10]+r[3]*e[14],i[3]=r[0]*e[3]+r[1]*e[7]+r[2]*e[11]+r[3]*e[15],n},n.prototype.transpose=function(){var t,e;return e=(t=this.elements)[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},n.prototype.setInverseOf=function(t){var e,r,n,i,o;if(r=t.elements,n=this.elements,(i=new Float32Array(16))[0]=r[5]*r[10]*r[15]-r[5]*r[11]*r[14]-r[9]*r[6]*r[15]+r[9]*r[7]*r[14]+r[13]*r[6]*r[11]-r[13]*r[7]*r[10],i[4]=-r[4]*r[10]*r[15]+r[4]*r[11]*r[14]+r[8]*r[6]*r[15]-r[8]*r[7]*r[14]-r[12]*r[6]*r[11]+r[12]*r[7]*r[10],i[8]=r[4]*r[9]*r[15]-r[4]*r[11]*r[13]-r[8]*r[5]*r[15]+r[8]*r[7]*r[13]+r[12]*r[5]*r[11]-r[12]*r[7]*r[9],i[12]=-r[4]*r[9]*r[14]+r[4]*r[10]*r[13]+r[8]*r[5]*r[14]-r[8]*r[6]*r[13]-r[12]*r[5]*r[10]+r[12]*r[6]*r[9],i[1]=-r[1]*r[10]*r[15]+r[1]*r[11]*r[14]+r[9]*r[2]*r[15]-r[9]*r[3]*r[14]-r[13]*r[2]*r[11]+r[13]*r[3]*r[10],i[5]=r[0]*r[10]*r[15]-r[0]*r[11]*r[14]-r[8]*r[2]*r[15]+r[8]*r[3]*r[14]+r[12]*r[2]*r[11]-r[12]*r[3]*r[10],i[9]=-r[0]*r[9]*r[15]+r[0]*r[11]*r[13]+r[8]*r[1]*r[15]-r[8]*r[3]*r[13]-r[12]*r[1]*r[11]+r[12]*r[3]*r[9],i[13]=r[0]*r[9]*r[14]-r[0]*r[10]*r[13]-r[8]*r[1]*r[14]+r[8]*r[2]*r[13]+r[12]*r[1]*r[10]-r[12]*r[2]*r[9],i[2]=r[1]*r[6]*r[15]-r[1]*r[7]*r[14]-r[5]*r[2]*r[15]+r[5]*r[3]*r[14]+r[13]*r[2]*r[7]-r[13]*r[3]*r[6],i[6]=-r[0]*r[6]*r[15]+r[0]*r[7]*r[14]+r[4]*r[2]*r[15]-r[4]*r[3]*r[14]-r[12]*r[2]*r[7]+r[12]*r[3]*r[6],i[10]=r[0]*r[5]*r[15]-r[0]*r[7]*r[13]-r[4]*r[1]*r[15]+r[4]*r[3]*r[13]+r[12]*r[1]*r[7]-r[12]*r[3]*r[5],i[14]=-r[0]*r[5]*r[14]+r[0]*r[6]*r[13]+r[4]*r[1]*r[14]-r[4]*r[2]*r[13]-r[12]*r[1]*r[6]+r[12]*r[2]*r[5],i[3]=-r[1]*r[6]*r[11]+r[1]*r[7]*r[10]+r[5]*r[2]*r[11]-r[5]*r[3]*r[10]-r[9]*r[2]*r[7]+r[9]*r[3]*r[6],i[7]=r[0]*r[6]*r[11]-r[0]*r[7]*r[10]-r[4]*r[2]*r[11]+r[4]*r[3]*r[10]+r[8]*r[2]*r[7]-r[8]*r[3]*r[6],i[11]=-r[0]*r[5]*r[11]+r[0]*r[7]*r[9]+r[4]*r[1]*r[11]-r[4]*r[3]*r[9]-r[8]*r[1]*r[7]+r[8]*r[3]*r[5],i[15]=r[0]*r[5]*r[10]-r[0]*r[6]*r[9]-r[4]*r[1]*r[10]+r[4]*r[2]*r[9]+r[8]*r[1]*r[6]-r[8]*r[2]*r[5],0===(o=r[0]*i[0]+r[1]*i[4]+r[2]*i[8]+r[3]*i[12]))return this;for(o=1/o,e=0;e<16;e++)n[e]=i[e]*o;return this},n.prototype.invert=function(){return this.setInverseOf(this)},n.prototype.setOrtho=function(t,e,r,n,i,o){var a,s,u,c;if(t===e||r===n||i===o)throw"null frustum";return s=1/(e-t),u=1/(n-r),c=1/(o-i),(a=this.elements)[0]=2*s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*u,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2*c,a[11]=0,a[12]=-(e+t)*s,a[13]=-(n+r)*u,a[14]=-(o+i)*c,a[15]=1,this},n.prototype.ortho=function(t,e,r,i,o,a){return this.concat((new n).setOrtho(t,e,r,i,o,a))},n.prototype.setFrustum=function(t,e,r,n,i,o){var a,s,u,c;if(t===e||n===r||i===o)throw"null frustum";if(i<=0)throw"near <= 0";if(o<=0)throw"far <= 0";return s=1/(e-t),u=1/(n-r),c=1/(o-i),(a=this.elements)[0]=2*i*s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*i*u,a[6]=0,a[7]=0,a[8]=(e+t)*s,a[9]=(n+r)*u,a[10]=-(o+i)*c,a[11]=-1,a[12]=0,a[13]=0,a[14]=-2*i*o*c,a[15]=0,this},n.prototype.frustum=function(t,e,r,i,o,a){return this.concat((new n).setFrustum(t,e,r,i,o,a))},n.prototype.setPerspective=function(t,e,r,n){var i,o,a,s;if(r===n||0===e)throw"null frustum";if(r<=0)throw"near <= 0";if(n<=0)throw"far <= 0";if(t=Math.PI*t/180/2,0===(a=Math.sin(t)))throw"null frustum";return o=1/(n-r),s=Math.cos(t)/a,(i=this.elements)[0]=s/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=-(n+r)*o,i[11]=-1,i[12]=0,i[13]=0,i[14]=-2*r*n*o,i[15]=0,this},n.prototype.perspective=function(t,e,r,i){return this.concat((new n).setPerspective(t,e,r,i))},n.prototype.setScale=function(t,e,r){var n=this.elements;return n[0]=t,n[4]=0,n[8]=0,n[12]=0,n[1]=0,n[5]=e,n[9]=0,n[13]=0,n[2]=0,n[6]=0,n[10]=r,n[14]=0,n[3]=0,n[7]=0,n[11]=0,n[15]=1,this},n.prototype.scale=function(t,e,r){var n=this.elements;return n[0]*=t,n[4]*=e,n[8]*=r,n[1]*=t,n[5]*=e,n[9]*=r,n[2]*=t,n[6]*=e,n[10]*=r,n[3]*=t,n[7]*=e,n[11]*=r,this},n.prototype.setTranslate=function(t,e,r){var n=this.elements;return n[0]=1,n[4]=0,n[8]=0,n[12]=t,n[1]=0,n[5]=1,n[9]=0,n[13]=e,n[2]=0,n[6]=0,n[10]=1,n[14]=r,n[3]=0,n[7]=0,n[11]=0,n[15]=1,this},n.prototype.translate=function(t,e,r){var n=this.elements;return n[12]+=n[0]*t+n[4]*e+n[8]*r,n[13]+=n[1]*t+n[5]*e+n[9]*r,n[14]+=n[2]*t+n[6]*e+n[10]*r,n[15]+=n[3]*t+n[7]*e+n[11]*r,this},n.prototype.setRotate=function(t,e,r,n){var i,o,a,s,u,c,l,f,h,y,p,v;return t=Math.PI*t/180,i=this.elements,o=Math.sin(t),a=Math.cos(t),0!==e&&0===r&&0===n?(e<0&&(o=-o),i[0]=1,i[4]=0,i[8]=0,i[12]=0,i[1]=0,i[5]=a,i[9]=-o,i[13]=0,i[2]=0,i[6]=o,i[10]=a,i[14]=0,i[3]=0,i[7]=0,i[11]=0,i[15]=1):0===e&&0!==r&&0===n?(r<0&&(o=-o),i[0]=a,i[4]=0,i[8]=o,i[12]=0,i[1]=0,i[5]=1,i[9]=0,i[13]=0,i[2]=-o,i[6]=0,i[10]=a,i[14]=0,i[3]=0,i[7]=0,i[11]=0,i[15]=1):0===e&&0===r&&0!==n?(n<0&&(o=-o),i[0]=a,i[4]=-o,i[8]=0,i[12]=0,i[1]=o,i[5]=a,i[9]=0,i[13]=0,i[2]=0,i[6]=0,i[10]=1,i[14]=0,i[3]=0,i[7]=0,i[11]=0,i[15]=1):(1!==(s=Math.sqrt(e*e+r*r+n*n))&&(e*=u=1/s,r*=u,n*=u),c=1-a,l=e*r,f=r*n,h=n*e,y=e*o,p=r*o,v=n*o,i[0]=e*e*c+a,i[1]=l*c+v,i[2]=h*c-p,i[3]=0,i[4]=l*c-v,i[5]=r*r*c+a,i[6]=f*c+y,i[7]=0,i[8]=h*c+p,i[9]=f*c-y,i[10]=n*n*c+a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1),this},n.prototype.rotate=function(t,e,r,i){return this.concat((new n).setRotate(t,e,r,i))},n.prototype.setLookAt=function(t,e,r,n,i,o,a,s,u){var c,l,f,h,y,p,v,m,g,d,b,w;return l=n-t,f=i-e,h=o-r,p=(f*=y=1/Math.sqrt(l*l+f*f+h*h))*u-(h*=y)*s,v=h*a-(l*=y)*u,m=l*s-f*a,d=(v*=g=1/Math.sqrt(p*p+v*v+m*m))*h-(m*=g)*f,b=m*l-(p*=g)*h,w=p*f-v*l,(c=this.elements)[0]=p,c[1]=d,c[2]=-l,c[3]=0,c[4]=v,c[5]=b,c[6]=-f,c[7]=0,c[8]=m,c[9]=w,c[10]=-h,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,this.translate(-t,-e,-r)},n.prototype.lookAt=function(t,e,r,i,o,a,s,u,c){return this.concat((new n).setLookAt(t,e,r,i,o,a,s,u,c))},n.prototype.dropShadow=function(t,e){var r=new n,i=r.elements,o=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3];return i[0]=o-e[0]*t[0],i[1]=-e[1]*t[0],i[2]=-e[2]*t[0],i[3]=-e[3]*t[0],i[4]=-e[0]*t[1],i[5]=o-e[1]*t[1],i[6]=-e[2]*t[1],i[7]=-e[3]*t[1],i[8]=-e[0]*t[2],i[9]=-e[1]*t[2],i[10]=o-e[2]*t[2],i[11]=-e[3]*t[2],i[12]=-e[0]*t[3],i[13]=-e[1]*t[3],i[14]=-e[2]*t[3],i[15]=o-e[3]*t[3],this.concat(r)},n.prototype.dropShadowDirectionally=function(t,e,r,n,i,o,a,s,u){var c=n*t+i*e+o*r;return this.dropShadow([t,e,r,-c],[a,s,u,0])};var i=function(t){var e=new Float32Array(3);t&&"object"===r(t)&&(e[0]=t[0],e[1]=t[1],e[2]=t[2]),this.elements=e};i.prototype.normalize=function(){var t=this.elements,e=t[0],r=t[1],n=t[2],i=Math.sqrt(e*e+r*r+n*n);return i?(1==i||(i=1/i,t[0]=e*i,t[1]=r*i,t[2]=n*i),this):(t[0]=0,t[1]=0,t[2]=0,this)};var o=function(t){var e=new Float32Array(4);t&&"object"===r(t)&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),this.elements=e},a=new Float32Array([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1]),s=new Uint8Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),u=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1]);function c(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var l=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.program=null,this.vertexBuffer=null,this.vertexColorBuffer=null,this.indexBuffer=null,this.a_position=null,this.a_Color=null,this.a_Normal=null,this.u_MvpMatrix=null,this.u_Color=null,this.u_NormalMatrix=null,this.u_LightColor=null,this.u_LightDirection=null,this.u_AmbientLight=null,this.gl=null,this.world=null,this.entitySize=null}var e,r,o;return e=t,(r=[{key:"setup",value:function(t,e,r,n){var o=t.gl;this.gl=t.gl,this.world=t,this.entitySize=e,this.program=this.createProgramm(o,"\n      attribute vec4 a_Position;\n      attribute vec4 a_Normal;\n      attribute vec4 a_Color;\n      uniform mat4 u_MvpMatrix;\n      uniform vec4 u_Color;\n      uniform mat4 u_NormalMatrix;    // Transformation matrix of normal\n      uniform vec3 u_LightColor;      // Light color\n      uniform vec3 u_LightDirection;  // World coordinate, normalized\n      uniform vec3 u_AmbientLight;    // Ambient light color\n      varying vec4 v_Color;\n\n      void main() {\n          gl_Position = u_MvpMatrix * a_Position;\n          \n          // Recalculate normal with normal matrix and make its length 1.0\n          vec3 normal = normalize(vec3(u_NormalMatrix * a_Normal));\n      \n          // The dot product of the light direction and the normal\n          float nDotL = max(dot(u_LightDirection, normal), 0.0);\n      \n          // Calculate the color due to diffuse reflection\n          vec3 diffuse = u_LightColor * u_Color.rgb * nDotL;\n      \n          // Calculate the color due to ambient reflection\n          vec3 ambient = u_AmbientLight * u_Color.rgb;\n      \n          // Add the surface colors due to diffuse and ambient reflection\n          v_Color = vec4(diffuse + ambient, u_Color.a);\n      }\n      ","\n      #ifdef GL_ES\n      precision mediump float;\n      #endif\n      varying vec4 v_Color;\n      \n      void main() {\n          gl_FragColor = v_Color;\n       \n      }\n      "),o.useProgram(this.program),this.vertexBuffer=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,this.vertexBuffer),o.bufferData(o.ARRAY_BUFFER,a,o.STATIC_DRAW),this.a_Position=o.getAttribLocation(this.program,"a_Position"),this.indexBuffer=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,null),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this.indexBuffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,s,o.STATIC_DRAW),this.vertexColorBuffer=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,this.vertexColorBuffer),n&&o.bufferData(o.ARRAY_BUFFER,new Float32Array(n),o.STATIC_DRAW),this.a_Color=o.getAttribLocation(this.program,"a_Color"),this.normalsBuffer=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,this.normalsBuffer),o.bufferData(o.ARRAY_BUFFER,u,o.STATIC_DRAW),this.a_Normal=o.getAttribLocation(this.program,"a_Normal"),this.u_NormalMatrix=o.getUniformLocation(this.program,"u_NormalMatrix"),this.u_LightColor=o.getUniformLocation(this.program,"u_LightColor"),this.u_LightDirection=o.getUniformLocation(this.program,"u_LightDirection"),this.u_AmbientLight=o.getUniformLocation(this.program,"u_AmbientLight");var c=new i([1,3,4]);c.normalize(),o.uniform3fv(this.u_LightDirection,c.elements),o.uniform3f(this.u_AmbientLight,.3,.3,.3),o.uniform3f(this.u_LightColor,1,1,1),this.u_MvpMatrix=o.getUniformLocation(this.program,"u_MvpMatrix"),this.u_Color=o.getUniformLocation(this.program,"u_Color")}},{key:"draw",value:function(t,e,r){var i=this.gl,o=this.program;i.useProgram(o),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer),i.vertexAttribPointer(this.a_Position,3,i.FLOAT,!1,0,0),i.enableVertexAttribArray(this.a_Position),i.bindBuffer(i.ARRAY_BUFFER,this.normalsBuffer),i.vertexAttribPointer(this.a_Normal,3,i.FLOAT,!1,0,0),i.enableVertexAttribArray(this.a_Normal);for(var a=new n,u=new n,c=new n,l=0;l<e.length;l+=2)u.setTranslate(2*e[l]-1,0,2*e[l+1]-1).scale(this.entitySize/1e3,this.entitySize/1e3,this.entitySize/1e3),a.set(this.world.projMatrix).multiply(this.world.viewMatrix).multiply(u),i.uniformMatrix4fv(this.u_MvpMatrix,!1,a.elements),c.setInverseOf(u),c.transpose(),i.uniformMatrix4fv(this.u_NormalMatrix,!1,c.elements),i.uniform4fv(this.u_Color,new Float32Array([r[l],r[l+1],0,1])),i.drawElements(i.TRIANGLES,s.length,i.UNSIGNED_BYTE,0)}},{key:"createProgramm",value:function(t,e,r){var n=this.loadShader(t,t.VERTEX_SHADER,e),i=this.loadShader(t,t.FRAGMENT_SHADER,r),o=t.createProgram();return t.attachShader(o,n),t.attachShader(o,i),t.linkProgram(o),o}},{key:"loadShader",value:function(t,e,r){var n=t.createShader(e);if(t.shaderSource(n,r),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){var i=e===t.VERTEX_SHADER?"vertex":e===t.FRAGMENT_SHADER?"fragment":"unknown type";console.error("The ".concat(i," shader could not be compiled"))}return n}},{key:"initAttributeVariable",value:function(t,e,r){t.bindBuffer(t.ARRAY_BUFFER,r),t.vertexAttribPointer(e,r.num,r.type,!1,0,0),t.enableVertexAttribArray(e)}}])&&c(e.prototype,r),o&&c(e,o),t}();function f(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||v(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function y(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function p(t,e,r){return e&&y(t.prototype,e),r&&y(t,r),t}function v(t,e){if(t){if("string"==typeof t)return m(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function g(t,e,r,n,i){var o,a=d.getBoundary(e,r,n,i),s=new d(a),u=function(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=v(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}(t);try{for(u.s();!(o=u.n()).done;){var c=o.value;s.insert(c)}}catch(t){u.e(t)}finally{u.f()}return s}var d=function(){function t(e){h(this,t),this.boundary=e,this.bucket=[],this.regions={},this.divided=!1,this.gathered=[]}return p(t,null,[{key:"getBoundary",value:function(t,e,r,n){var i=(r-t)/2,o=(n-e)/2;return new b(r-i,n-o,i,o)}},{key:"getQuerySurface",value:function(t,e,r,n){return new b(t,e,r/2,n/2)}}]),p(t,[{key:"insert",value:function(e){if(!this.boundary.contains(e))return!1;if(!this.divided){if(this.bucket.length<t.capacity)return this.bucket.push(e),!0;this.subdivide(),this.transferBucket()}this.passToChild(e)}},{key:"passToChild",value:function(t){return t.x>this.boundary.x?t.y>this.boundary.y?this.regions.se.insert(t):this.regions.ne.insert(t):t.y>this.boundary.y?this.regions.sw.insert(t):this.regions.nw.insert(t)}},{key:"subdivide",value:function(){var e=this.boundary,r=e.x,n=e.y,i=this.boundary.w/2,o=this.boundary.h/2,a=new b(r-i,n-o,i,o),s=new b(r+i,n-o,i,o),u=new b(r-i,n+o,i,o),c=new b(r+i,n+o,i,o);this.regions.nw=new t(a,t.capacity),this.regions.ne=new t(s,t.capacity),this.regions.sw=new t(u,t.capacity),this.regions.se=new t(c,t.capacity),this.divided=!0}},{key:"transferBucket",value:function(){var t=this;this.bucket.forEach((function(e){t.passToChild(e)})),this.bucket=null}},{key:"query",value:function(t){return this.boundary.intersects(t)?t.encompasses(this.boundary)?this.gather(t):this.divided?[].concat(f(this.regions.nw.query(t)),f(this.regions.ne.query(t)),f(this.regions.sw.query(t)),f(this.regions.se.query(t))):this.bucket:[]}},{key:"gather",value:function(t){return this.divided?[].concat(f(this.regions.nw.gather(t)),f(this.regions.ne.gather(t)),f(this.regions.sw.gather(t)),f(this.regions.se.gather(t))):this.bucket}}]),t}(),b=function(){function t(e,r,n,i){h(this,t),this.x=e,this.y=r,this.w=n,this.h=i}return p(t,[{key:"contains",value:function(t){var e=this;return t.x>e.x-e.w&&t.x<e.x+e.w&&t.y>e.y-e.h&&t.y<e.y+e.h}},{key:"intersects",value:function(t){var e=this;return!(t.x-t.w>e.x+e.w||t.x+t.w<e.x-e.w||t.y-t.h>e.y+e.h||t.y+t.h<e.y-e.h)}},{key:"encompasses",value:function(t){var e=this;return t.x-t.w>=e.x-e.w&&t.x+t.w<=e.x+e.w&&t.y-t.h>=e.y-e.h&&t.y+t.h<=e.y+e.h}}]),t}();function w(t){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _(t,e,r){return(_="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=k(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(r):i.value}})(t,e,r||t)}function A(t,e){return(A=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function S(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=k(t);if(e){var i=k(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return x(this,r)}}function x(t,e){return!e||"object"!==w(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function k(t){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function R(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function P(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function O(t,e,r){return e&&P(t.prototype,e),r&&P(t,r),t}d.capacity=4;var E=function(){function t(e,r,n,i,o){R(this,t),this.x=null!=n?n:Math.random(),this.y=null!=i?i:Math.random(),this.world=e,this.energy=o||0,this.reserves=0,this.team=r,this.saveForKiller=!1,this.saveForGuard=!1}return O(t,[{key:"getEnergy",value:function(e){this.energy+=e*(1-t.savingRate),this.reserves+=e*t.savingRate}},{key:"sendEnergy",value:function(t){var e=0;return this.energy>t?(e=t,this.energy-=t):(e=this.energy,this.energy=0),e}},{key:"work",value:function(){var e=this.world.register,r=e.Bugs,n=e.Killers,i=e.Guards;this.saveForKiller||this.saveForGuard?(this.saveForKiller&&this.energy>10&&(n.create(this.team,this.x,this.y),this.energy-=10,this.saveForKiller=!1),this.saveForGuard&&this.energy>40&&(i.create(this.team,this.x,this.y),this.energy-=40,this.saveForGuard=!1)):this.energy>t.energyBuffer&&(r.create(this.team,this.x,this.y),this.energy--),this.reserves>10&&(n.create(this.team,this.x,this.y),this.reserves-=10)}},{key:"getDistance",value:function(t){return Math.sqrt(Math.pow(t.y-this.y,2)+Math.pow(t.x-this.x,2))}},{key:"getManhattanDistance",value:function(t){return Math.pow(t.y-this.y,2)+Math.pow(t.x-this.x,2)}}]),t}(),M=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&A(t,e)}(r,t);var e=S(r);function r(){var t;return R(this,r),(t=e.call(this)).elements=[],t.register={},t.world=null,t}return O(r,[{key:"setup",value:function(t,e){this.world=e;var n=new E(this.world,Lt.team.blue,.5,.8,30);this.elements.push(n),this.register[Lt.team.blue]=n;var i=new E(this.world,Lt.team.red,.5,.2,30);this.elements.push(i),this.register[Lt.team.red]=i,window.addEventListener("click",(function(){i.saveForKiller=!0}));var o=E.size*e.surface,a=this.getBasesPositions(),s=this.getBugsTeams();_(k(r.prototype),"setup",this).call(this,e,o,a,s)}},{key:"getBasesPositions",value:function(){var t=[];return this.elements.forEach((function(e){t.push(e.x,e.y)})),t}},{key:"getBugsTeams",value:function(){var t=[];return this.elements.forEach((function(e){t.push(1,e.team)})),t}},{key:"draw",value:function(){}},{key:"update",value:function(){this.elements.forEach((function(t){return t.work()}))}}]),r}(l);function T(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return F(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return F(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function j(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var C=function(){function t(e,r,n,i,o,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=null!=n?n:Math.random(),this.y=null!=i?i:Math.random(),this.vX=Math.random()-.5,this.vY=Math.random()-.5,this.engergyLimit=a,this.energy=.8*Math.random()*a+.2*a,this.team=r,this.home={x:.5,y:0===this.team?.2:.8},this.maxSpeed=o,this.world=e}var e,r,n;return e=t,(r=[{key:"move",value:function(){this.x+=this.vX/this.maxSpeed,this.y+=this.vY/this.maxSpeed,this.x<0?(this.vX*=-1,this.x*=-1):this.x>1&&(this.vX*=-1,this.x=2-this.x),this.y<0?(this.vY*=-1,this.y*=-1):this.y>1&&(this.vY*=-1,this.y=2-this.y)}},{key:"eat",value:function(){var t=this.world.register.Ground.collect(this);return this.energy=Math.min(this.engergyLimit,this.energy+t),this}},{key:"findFood",value:function(){var t=T(this.world.register.Ground.inspectSurroundingFertility(this),2),e=t[0],r=t[1];this.vX+=Math.min(1,e)/20,this.vY+=Math.min(1,r)/20;var n=Math.pow(this.vX,2)+Math.pow(this.vY,2);n>1&&(this.vX/=n,this.vY/=n)}},{key:"goHome",value:function(){this.goTowardsTarget(this.home)}},{key:"goTowardsTarget",value:function(t){var e=T(this.normalize(t.x-this.x,t.y-this.y),2),r=e[0],n=e[1],i=r-this.vX,o=n-this.vY;this.vX+=.01*i,this.vY+=.01*o;var a=T(this.normalize(this.vX,this.vY,!0),2),s=a[0],u=a[1];this.vX=s,this.vY=u}},{key:"normalize",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=Math.pow(t,2)+Math.pow(e,2);return r&&n<1?[t,e]:[t/n,e/n]}},{key:"getDistance",value:function(t){return Math.sqrt(Math.pow(t.y-this.y,2)+Math.pow(t.x-this.x,2))}},{key:"getManhattanDistance",value:function(t){return Math.pow(t.y-this.y,2)+Math.pow(t.x-this.x,2)}}])&&j(e.prototype,r),n&&j(e,n),t}();function L(t){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function B(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function D(t,e,r){return(D="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=z(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(r):i.value}})(t,e,r||t)}function I(t,e){return(I=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function U(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=z(t);if(e){var i=z(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Y(this,r)}}function Y(t,e){return!e||"object"!==L(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function z(t){return(z=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var N=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&I(t,e)}(o,t);var e,r,n,i=U(o);function o(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this)).individuals=[],r.world=null,r.initialPopulation=t,r.entityType=e,r}return e=o,(r=[{key:"setup",value:function(t,e){this.world=e;for(var r=0;r<this.initialPopulation;r+=2)this.individuals.push(new this.entityType(this.world,this.entityType.team.red)),this.individuals.push(new this.entityType(this.world,this.entityType.team.blue));var n=Math.floor(this.entityType.size*e.surface);D(z(o.prototype),"setup",this).call(this,e,n)}},{key:"getPotentialTouching",value:function(t){var e=this.entityType.size/2+t.constructor.size/2,r=new b(t.x,t.y,e,e);return[this.qtree.query(r),e]}},{key:"getPositions",value:function(){var t=[];return this.individuals.forEach((function(e){t.push(e.x,e.y)})),t}},{key:"getEnergy",value:function(){var t=[];return this.individuals.forEach((function(e){t.push(e.energy)})),t}},{key:"getTeams",value:function(){var t=[];return this.individuals.forEach((function(e){t.push(e.team)})),t}},{key:"draw",value:function(){var t=this.getPositions(),e=this.getEnergy(),r=this.getTeams(),n=e.reduce((function(t,e,n){return t.push(e,r[n]),t}),[]);D(z(o.prototype),"draw",this).call(this,this.individuals.length,t,n)}},{key:"create",value:function(t,e,r){this.individuals.push(new this.entityType(this.world,t,e,r))}},{key:"prepareUpdate",value:function(){this.qtree=g(this.individuals,0,0,1,1)}}])&&B(e.prototype,r),n&&B(e,n),o}(l);function q(t){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function G(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return H(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return H(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function X(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function V(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function K(t,e,r){return e&&V(t.prototype,e),r&&V(t,r),t}function W(t,e,r){return(W="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=tt(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(r):i.value}})(t,e,r||t)}function $(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Q(t,e)}function Q(t,e){return(Q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function J(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=tt(t);if(e){var i=tt(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Z(this,r)}}function Z(t,e){return!e||"object"!==q(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function tt(t){return(tt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var et=function(t){$(r,t);var e=J(r);function r(t,n,i,o){var a;return X(this,r),(a=e.call(this,t,n,i,o,r.maxSpeed,r.energyLimit)).task=r.activity.gather,a}return K(r,[{key:"alter",value:function(){return this.energy=this.energy-.001,this}},{key:"interact",value:function(t){var e=this,r=G(t.getPotentialTouching(this),2),n=r[0],i=r[1];return n.forEach((function(t){e.getDistance(t)<i&&t.team!==e.team&&("Killer"===t.constructor.name?e.energy=.99*e.energy-.008:e.energy=.98*e.energy-.01)})),this}},{key:"work",value:function(){return this.energy>2?this.task===r.activity.attack?this.attack():this.patrol():(this.task=r.activity.goHome,this.goHome()),this}},{key:"patrol",value:function(){var t=this,e=this.world.register.Killers.qtree,n=new b(this.home.x,this.home.y,E.defenseArea,E.defenseArea),i=G(e.query(n).filter((function(e){return e.team!==t.team})).filter((function(e){return e.getDistance(t.home)<E.defenseArea})).reduce((function(e,r){var n=t.getDistance(r);return n<e[1]&&(e=[r,n]),e}),[null,1/0]),2),o=i[0];i[1];o&&(this.target=o,this.task=r.activity.attack,this.goTowardsTarget(this.target))}},{key:"attack",value:function(){this.target&&this.target.energy>0?this.goTowardsTarget(this.target):(this.target=null,this.task=r.activity.patrol)}},{key:"goHome",value:function(){var t=this.world.register.Bases;if(this.getDistance(this.home)<.03)return this.energy+=t.register[this.team].sendEnergy(r.energyTransfer),void(this.task=r.activity.patrol);W(tt(r.prototype),"goHome",this).call(this)}}]),r}(C);et.team={red:0,blue:1},et.activity={attack:0,patrol:1,goHome:2},et.perceptionLimit=.1,et.energyTransfer=5,et.energyLimit=10;var rt=function(t){$(r,t);var e=J(r);function r(t){return X(this,r),e.call(this,t,et)}return K(r,[{key:"update",value:function(){var t=this.world.register,e=t.Guards,r=t.Killers,n=t.Bases;this.individuals.forEach((function(t){return t.move()})),this.individuals.forEach((function(t){t.alter().interact(e).interact(r).work()})),this.individuals=this.individuals.filter((function(t){return t.energy>0})),this.individuals.some((function(t){return t.team===et.team.red}))||(n.elements.find((function(t){return t.team===et.team.red})).saveForGuard=!0),this.individuals.some((function(t){return t.team===et.team.blue}))||(n.elements.find((function(t){return t.team===et.team.blue})).saveForGuard=!0)}}]),r}(N);function nt(t){return(nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function it(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ot(t,e){return(ot=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function at(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=ut(t);if(e){var i=ut(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return st(this,r)}}function st(t,e){return!e||"object"!==nt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ut(t){return(ut=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ct=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ot(t,e)}(a,t);var e,r,i,o=at(a);function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this)).itemsPerLine=t,e.tileSize=1/t,e.program=null,e.vertexBuffer=null,e.vertexColorBuffer=null,e.a_position=null,e.a_Color=null,e.u_MvpMatrix=null,e.gl=null,e.ground=[],e.colors=[],e.world=null,e}return e=a,(r=[{key:"generateVerticesGround",value:function(){for(var t=[],e=this.tileSize,r=0;r<this.itemsPerLine;r++)for(var n=0;n<this.itemsPerLine;n++){var i=n*e*2-1,o=r*e*2-1;t.push(i,-.03,o),i=n*e*2-1,o=(r+1)*e*2-1,t.push(i,-.03,o),i=(n+1)*e*2-1,o=(r+1)*e*2-1,t.push(i,-.03,o),i=n*e*2-1,o=r*e*2-1,t.push(i,-.03,o),i=(n+1)*e*2-1,o=(r+1)*e*2-1,t.push(i,-.03,o),i=(n+1)*e*2-1,o=r*e*2-1,t.push(i,-.03,o)}return t}},{key:"setup",value:function(t,e){this.gl=t,this.world=e;for(var r=0;r<this.itemsPerLine;r++)for(var n=0;n<this.itemsPerLine;n++)this.colors.push(.5*Math.random()+.1);this.ground=this.generateVerticesGround();var i="\n    attribute vec4 a_Position;\n    attribute vec4 a_Color;\n    uniform mat4 u_MvpMatrix;\n    varying vec4 v_Color;\n    void main() {\n        gl_Position = u_MvpMatrix * a_Position;\n        //gl_Position = u_MvpMatrix * vec4(a_Position.x,0.0,a_Position.y, 1.0);\n        gl_PointSize = ".concat(Math.round(this.tileSize*e.surface),".;\n        v_Color = a_Color;\n    }\n    ");this.program=this.createProgramm(t,i,"\n    precision mediump float;\n    varying vec4 v_Color;\n    \n    void main() {\n        gl_FragColor = vec4(v_Color.r*0.2, v_Color.r, v_Color.r*0.3, 1.0);\n       \n    }\n    "),t.useProgram(this.program),this.vertexBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.ground),t.STATIC_DRAW),this.a_Position=t.getAttribLocation(this.program,"a_Position"),this.u_MvpMatrix=t.getUniformLocation(this.program,"u_MvpMatrix"),this.vertexColorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vertexColorBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.colors),t.STATIC_DRAW),this.a_Color=t.getAttribLocation(this.program,"a_Color")}},{key:"draw",value:function(){var t=this.gl,e=this.program;t.useProgram(e),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.vertexAttribPointer(this.a_Position,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(this.a_Position);var r=new Float32Array(6*this.colors.length);this.colors.forEach((function(t,e){var n=6*e;r[n]=t,r[n+1]=t,r[n+2]=t,r[n+3]=t,r[n+4]=t,r[n+5]=t})),t.bindBuffer(t.ARRAY_BUFFER,this.vertexColorBuffer),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.vertexAttribPointer(this.a_Color,1,t.FLOAT,!1,0,0),t.enableVertexAttribArray(this.a_Color);var i=new n,o=new n;i.set(this.world.projMatrix).multiply(this.world.viewMatrix).multiply(o),t.uniformMatrix4fv(this.u_MvpMatrix,!1,i.elements),t.drawArrays(t.TRIANGLES,0,this.ground.length/3)}},{key:"update",value:function(){for(var t=0;t<this.colors.length;t++)this.colors[t]=Math.max(0,Math.min(this.colors[t]+Math.random()/2e3,1))}},{key:"getColorIndex",value:function(t){var e=t.x,r=t.y,n=Math.floor(e/this.tileSize);return Math.floor(r/this.tileSize)*this.itemsPerLine+n}},{key:"collect",value:function(t){var e=this.getColorIndex(t);if(this.colors[e]>.05){var r=.03*this.colors[e];return this.colors[e]-=r,r}return 0}},{key:"inspectSurroundingFertility",value:function(t){var e,r,n,i=this.getColorIndex(t);return r=(this.colors[i-this.itemsPerLine-1]||0)+(this.colors[i-this.itemsPerLine]||0)+(this.colors[i-this.itemsPerLine+1]||0),e=(this.colors[i+this.itemsPerLine-1]||0)+(this.colors[i+this.itemsPerLine]||0)+(this.colors[i+this.itemsPerLine+1]||0),n=(this.colors[i-this.itemsPerLine-1]||0)+(this.colors[i-1]||0)+(this.colors[i+this.itemsPerLine-1]||0),[(this.colors[i-this.itemsPerLine+1]||0)+(this.colors[i+1]||0)+(this.colors[i+this.itemsPerLine+1]||0)-n,e-r]}}])&&it(e.prototype,r),i&&it(e,i),a}(l);function lt(t){return(lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ft(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return ht(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ht(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ht(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function yt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function pt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function vt(t,e,r){return e&&pt(t.prototype,e),r&&pt(t,r),t}function mt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&gt(t,e)}function gt(t,e){return(gt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function dt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=wt(t);if(e){var i=wt(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return bt(this,r)}}function bt(t,e){return!e||"object"!==lt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function wt(t){return(wt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var _t=function(t){mt(r,t);var e=dt(r);function r(t,n,i,o){var a;return yt(this,r),(a=e.call(this,t,n,i,o,r.maxSpeed,r.energyLimit)).task=r.activity.gather,a}return vt(r,[{key:"alter",value:function(){return this.energy=.995*this.energy-.001,this}},{key:"interact",value:function(t){var e=this,r=ft(t.getPotentialTouching(this),2),n=r[0],i=r[1];return n.forEach((function(t){e.getDistance(t)<i&&t.team!==e.team&&(e.energy=.98*e.energy-.01)})),this}},{key:"work",value:function(){return this.energy>2?this.attack():(this.task=r.activity.gather,this.findFood()),this}},{key:"attack",value:function(){var t=this,e=this.world.register.Bugs.qtree;if(this.target&&this.target.energy>0)this.goTowardsTarget(this.target);else{var n=new b(this.x,this.y,r.perceptionLimit,r.perceptionLimit),i=ft(e.query(n).filter((function(e){return e.team!==t.team})).reduce((function(e,r){var n=t.getDistance(r);return n<e[1]&&(e=[r,n]),e}),[null,1/0]),2),o=i[0],a=i[1];o&&a<r.perceptionLimit&&(this.target=o,this.goTowardsTarget(o))}}}]),r}(C);_t.team={red:0,blue:1},_t.activity={gather:0,bringFood:1},_t.energyTransfer=.5,_t.energyLimit=10,_t.perceptionLimit=.2;var At=function(t){mt(r,t);var e=dt(r);function r(t){return yt(this,r),e.call(this,t,_t)}return vt(r,[{key:"update",value:function(){var t=this.world.register,e=t.Guards,r=t.Killers;this.individuals.forEach((function(t){return t.move()})),this.individuals.forEach((function(t){return t.alter().interact(r).interact(e).eat().work()})),this.individuals=this.individuals.filter((function(t){return t.energy>0}))}}]),r}(N);function St(t){return(St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return kt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return kt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function kt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Rt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Pt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ot(t,e,r){return e&&Pt(t.prototype,e),r&&Pt(t,r),t}function Et(t,e,r){return(Et="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ct(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(r):i.value}})(t,e,r||t)}function Mt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Tt(t,e)}function Tt(t,e){return(Tt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ft(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Ct(t);if(e){var i=Ct(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return jt(this,r)}}function jt(t,e){return!e||"object"!==St(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ct(t){return(Ct=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Lt=function(t){Mt(r,t);var e=Ft(r);function r(t,n,i,o){var a;return Rt(this,r),(a=e.call(this,t,n,i,o,r.maxSpeed,r.energyLimit)).task=r.activity.gather,a}return Ot(r,[{key:"alter",value:function(){return this.energy=.995*this.energy-.001,this}},{key:"interact",value:function(t){var e=this,r=xt(t.getPotentialTouching(this),2),n=r[0],i=r[1],o=Math.pow(i,2);return n.forEach((function(t){e.getManhattanDistance(t)<o&&t.team!==e.team&&(e.energy=.98*e.energy-.01)})),this}},{key:"work",value:function(){return this.task===r.activity.gather&&(this.energy>.9?this.task=r.activity.bringFood:this.findFood()),this.task===r.activity.bringFood&&this.goHome(),this}},{key:"goHome",value:function(){var t=this.world.register.Bases;if(this.getDistance(this.home)<.03)return this.task=r.activity.gather,void(this.energy>r.energyTransfer?(t.register[this.team].getEnergy(r.energyTransfer),this.energy-=r.energyTransfer):(t.register[this.team].getEnergy(this.energy/2),this.energy/=2));Et(Ct(r.prototype),"goHome",this).call(this)}}]),r}(C);Lt.team={red:0,blue:1},Lt.activity={gather:0,bringFood:1},Lt.energyTransfer=.5,Lt.energyLimit=1;var Bt=function(t){Mt(r,t);var e=Ft(r);function r(t){return Rt(this,r),e.call(this,t,Lt)}return Ot(r,[{key:"update",value:function(){var t=this.world.register,e=t.Bugs,r=t.Killers;this.individuals.forEach((function(t){return t.move()})),this.individuals.forEach((function(t){return t.alter().interact(e).interact(r).eat().work()})),this.individuals=this.individuals.filter((function(t){return t.energy>0}))}}]),r}(N);function Dt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var It=function(){function t(r,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.surface=r,this.canvas=document.querySelector(i),this.canvas.width=r,this.canvas.height=r,this.gl=this.canvas.getContext("webgl",{antialias:!0}),this.gl.clearColor(0,0,0,1),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.enable(this.gl.DEPTH_TEST),this.elements=[],this.register={},this.viewMatrix=(new n).setLookAt(0,5,1,0,0,0,0,1,0),this.projMatrix=(new n).setPerspective(30,this.canvas.width/this.canvas.height,2,100),this.stats=new e(60,"#stats")}var r,i,o;return r=t,(i=[{key:"add",value:function(t){this.elements.push(t),this.register[t.constructor.name]=t,t.setup(this.gl,this)}},{key:"draw",value:function(t){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.viewMatrix=(new n).setLookAt(3*Math.cos(t/4e4),3,3*Math.sin(t/4e4),0,0,0,0,1,0),this.elements.forEach((function(t){t.draw()}))}},{key:"update",value:function(){this.elements.forEach((function(t){t.prepareUpdate&&t.prepareUpdate()})),this.elements.forEach((function(t){t.update()}))}},{key:"animate",value:function(t){requestAnimationFrame(this.animate.bind(this)),this.generateStats(t),this.update(),this.draw(t)}},{key:"generateStats",value:function(t){}}])&&Dt(r.prototype,i),o&&Dt(r,o),t}();Lt.size=.02,Lt.maxSpeed=700,_t.size=1/30,_t.maxSpeed=500,et.size=.05,et.maxSpeed=440,E.size=.1,E.savingRate=.1,E.energyBuffer=5,E.defenseArea=.3;var Ut=new It(800,"canvas");window.world=Ut;var Yt=new ct(200),zt=new M,Nt=new Bt(100),qt=new At(2),Gt=new rt(2);Ut.add(Yt),Ut.add(Nt),Ut.add(qt),Ut.add(Gt),Ut.add(zt),Ut.animate()}();
//# sourceMappingURL=Bugs.144db1c2.js.map
